# ${license-info}
# ${developer-info}
# ${author-info}

# Note: all methods in this component are called in a
# $self->$method ($config) way, unless explicitly stated.

package NCM::Component::aiiserver;

use strict;
use warnings;
use NCM::Component;
use EDG::WP4::CCM::Property;
use NCM::Check;
use FileHandle;

use LC::File qw (makedir);

use constant PATH	=> "/software/components/aiiserver";
use constant AIIDIR	=> "/etc/aii";
use constant AIISHELLFE	=> AIIDIR . "/aii-shellfe.conf";
use constant AIIDHCP	=> AIIDIR . "/aii-dhcp.conf";

our @ISA = qw (NCM::Component);
our $EC = LC::Exception::Context->new->will_store_all;

sub Configure
{
    my ($self, $config) = @_;

    my $t = $config->getElement (PATH)->getTree;
    makedir (AIIDIR);
    open (FH, ">" . AIISHELLFE);
    print FH<<EOF;
# File generated by ncm-aiiserver
# Do not edit
EOF

    while (my ($k, $v) = each (%{$t->{"aii-shellfe"}})) {
	print FH "$k = $v\n";
    }
    close (FH);
    open (FH, ">" . AIIDHCP);

    print FH <<EOF;
# File generated by ncm-aiiserver
# Do not edit
EOF
    while (my ($k, $v) = each (%{$t->{"aii-dhcp"}})) {
	print FH "$k = $v\n";
    }
    close (FH);

    return 1;
}

1;
